@*@using CobrArWeb.Models.RechercheArbo;
@model List<CobrArWeb.Models.RechercheArbo.EquipeViewModel>

<h1>Recherche d'arborescence</h1>

@foreach (var equipe in Model)
{
    <h2>Equipe : @equipe.Equipe</h2>

    <div>
        <form asp-controller="Product" asp-action="Search" method="get">
            <input type="hidden" name="equipe" value="@equipe.Equipe" />
            <button type="submit">Voir tous les produits de l'équipe</button>
        </form>
    </div>

    <div>
        @foreach (var categorie in equipe.Categorie)
        {
            <button onclick="showCategories('@equipe.Equipe', '@categorie.Categorie')">Catégorie : @categorie.Categorie</button>

            <div id="@($"souscategories-{equipe.Equipe}-{categorie.Categorie}")" style="display:none">
                @foreach (var souscategorie in categorie.SousCategorie)
                {
                    <button onclick="showProducts('@equipe.Equipe', '@categorie.Categorie', '@souscategorie.Products')">@souscategorie.Products</button>
                }
            </div>
        }
    </div>

    <div id="@($"produits-{equipe.Equipe}")"></div>

    <hr />
}

<script>
    function showCategories(equipe, categorie) {
        // Récupérer l'élément div qui contiendra les sous-catégories
        var divSousCategories = document.getElementById(`souscategories-${equipe}-${categorie}`);

        // Si les sous-catégories ne sont pas déjà affichées
        if (divSousCategories.style.display === "none") {
            // Récupérer les sous-catégories correspondantes via une requête AJAX
            $.ajax({
                url: '@Url.Action("GetSousCategories", "Product")',
                data: { equipe: equipe, categorie: categorie },
                success: function (data) {
                    // Ajouter les sous-catégories à la div correspondante
                    divSousCategories.innerHTML = data;
                }
            });

            // Afficher la div
            divSousCategories.style.display = "block";
        } else {
            // Masquer la div
            divSousCategories.style.display = "none";
        }
    }

    function showProducts(equipe, categorie, souscategorie) {
        // Récupérer l'élément div qui contiendra les produits
        var divProduits = document.getElementById(`produits-${equipe}`);

        // Récupérer les produits correspondants via une requête AJAX
        $.ajax({
            url: '@Url.Action("GetProducts", "Product")',
            data: { equipe: equipe, categorie: categorie, souscategorie: souscategorie },
            success: function (data) {
                // Ajouter les produits à la div correspondante
                divProduits.innerHTML = data;
            }
        });
    }
</script>
*@



@using CobrArWeb.Models.RechercheArbo;
@model List<EquipeViewModel>
@section scripts {

}



<table>
    <thead>
        <tr>
            <th>Code Barre</th>
            <th>Produit</th>
            <th>Catégorie</th>
            <th>Sous-Catégorie</th>
            <th>Taille</th>
            <th>Quantite</th>
            <th>Prix</th>
            <th>Fournisseur</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var equipe in Model)
        {
            <tr>
                <td>@equipe.Equipe</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            @foreach (var category in equipe.Categorie)
            {
                <tr>
                    <td></td>
                    <td>@category.Categorie</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>
                @foreach (var souscategory in category.SousCategorie)
                {
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td>@souscategory.Name</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    @foreach (var product in souscategory.Products)
                    {
                        <tr>
                            <td>@product.CodeBarre</td>
                            <td>@product.Produit</td>
                            <td>@product.Categorie</td>
                            <td>@product.SousCategorie</td>
                            <td>@product.Taille</td>
                            <td>@product.Quantite</td>
                            <td>@product.Prix</td>
                            <td>@product.Fournisseur</td>
                            <td>
                                <a asp-controller="cart" asp-action="buy" asp-route-id="@product.Id">Ajouter Au Panier</a>
                        </tr>
                    }
                }
            }
        }
    </tbody>
</table>


<script src="~/js/site.js" asp-append-version="true"></script>       